<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>–ù–∞—à –°—á—ë—Ç—á–∏–∫ ‚ù§Ô∏è</title>

    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="myy.png">

    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    <script>
      window.OneSignalDeferred = window.OneSignalDeferred || [];
      OneSignalDeferred.push(async function(OneSignal) {
        await OneSignal.init({
          appId: "4441fd3b-60ff-440c-8c05-1e611714735e",
        });
      });
    </script>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;600&family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <style>
        :root {
            --love-gradient: linear-gradient(135deg, #ff758c 0%, #ff7eb3 100%);
            --glass: rgba(255, 255, 255, 0.2);
        }

        body {
            margin: 0;
            padding: env(safe-area-inset-top) 0 env(safe-area-inset-bottom) 0;
            height: 100vh;
            overflow: hidden;
            font-family: 'Montserrat', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #fdf2f4;
            background: radial-gradient(circle at top, #fff5f7, #fde2e9);
        }

        #app {
            z-index: 10;
            width: 85%;
            max-width: 380px;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .love-counter {
            background: white;
            padding: 25px 15px;
            border-radius: 30px;
            box-shadow: 0 10px 30px rgba(255, 117, 140, 0.15);
        }

        .love-counter h1 {
            font-family: 'Pacifico', cursive;
            color: #ff4b6e;
            margin: 0 0 15px 0;
            font-size: 1.4rem;
        }

        .timer-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .timer-item { display: flex; flex-direction: column; }

        .timer-number {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }

        .timer-label {
            font-size: 0.6rem;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .chat-area {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 15px;
            height: 45vh;
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        #messages {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 5px;
        }

        .msg {
            padding: 12px 18px;
            border-radius: 20px;
            font-size: 0.9rem;
            max-width: 80%;
            line-height: 1.4;
            word-wrap: break-word;
            animation: zoomIn 0.4s ease;
        }

        .me {
            align-self: flex-end;
            background: var(--love-gradient);
            color: white;
            border-bottom-right-radius: 4px;
            box-shadow: 0 4px 15px rgba(255, 117, 140, 0.3);
        }

        .her {
            align-self: flex-start;
            background: white;
            color: #555;
            border-bottom-left-radius: 4px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.03);
        }

        .input-box {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        input {
            flex: 1;
            border: none;
            border-radius: 20px;
            padding: 12px 15px;
            outline: none;
            background: white;
            font-family: 'Montserrat';
            font-size: 0.9rem;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.02);
        }

        .btn-send {
            background: var(--love-gradient);
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .heart-float {
            position: fixed;
            bottom: -50px;
            pointer-events: none;
            z-index: 1;
            animation: floatUp linear forwards;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 0.8; }
            100% { transform: translateY(-110vh) scale(1.5); opacity: 0; }
        }
    </style>
</head>
<body>

<div id="app" class="animate__animated animate__fadeIn">
    <div class="love-counter">
        <h1 id="title">–õ—é–±–ª—é —Ç–µ–±—è —É–∂–µ ‚ù§Ô∏è</h1>
        <div class="timer-grid">
            <div class="timer-item"><span class="timer-number" id="days">0</span><span class="timer-label">–î–Ω–µ–π</span></div>
            <div class="timer-item"><span class="timer-number" id="hours">0</span><span class="timer-label">–ß–∞—Å</span></div>
            <div class="timer-item"><span class="timer-number" id="mins">0</span><span class="timer-label">–ú–∏–Ω</span></div>
            <div class="timer-item"><span class="timer-number" id="secs">0</span><span class="timer-label">–°–µ–∫</span></div>
        </div>
    </div>

    <div class="chat-area">
        <div id="messages"></div>
        <div class="input-box">
            <input type="text" id="uInput" placeholder="–ù–∞–ø–∏—à–∏ —á—Ç–æ-—Ç–æ –Ω–µ–∂–Ω–æ–µ...">
            <button class="btn-send" onclick="sendMsg()">‚ù§Ô∏è</button>
        </div>
    </div>
</div>

<script>
    const START_DATE = "2025-12-22T19:29:45"; 
    const ONESIGNAL_APP_ID = "4441fd3b-60ff-440c-8c05-1e611714735e";
    const ONESIGNAL_REST_KEY = "4441fd3b-60ff-440c-8c05-1e611714735e"; // –ù–∞–π—Ç–∏ –≤ Settings -> API Keys

    const firebaseConfig = {
        apiKey: "AIzaSyDvF1USp7BnmWT9WBWlpikh6fwzM5RY8LU",
        databaseURL: "https://planning-with-ai-3778e-default-rtdb.firebaseio.com/",
        projectId: "planning-with-ai-3778e",
        appId: "1:529178865890:web:259924626fb1827abd6ebb"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const chatRef = db.ref("love_notes");

    let myRole = localStorage.getItem("role") || (confirm("–¢—ã?") ? "me" : "her");
    localStorage.setItem("role", myRole);

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—É—à–∞
    async function sendPush(text) {
        if (ONESIGNAL_REST_KEY === "–í–°–¢–ê–í–¨_–°–Æ–î–ê_REST_API_KEY") return;
        
        try {
            await fetch("https://onesignal.com/api/v1/notifications", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json; charset=utf-8",
                    "Authorization": "Basic " + ONESIGNAL_REST_KEY
                },
                body: JSON.stringify({
                    app_id: ONESIGNAL_APP_ID,
                    included_segments: ["Total Subscriptions"],
                    headings: {"ru": "–ù–æ–≤–æ–µ –ø–æ—Å–ª–∞–Ω–∏–µ ‚ù§Ô∏è"},
                    contents: {"ru": text}
                })
            });
        } catch(e) { console.error("Push error", e); }
    }

    function sendMsg() {
        const inp = document.getElementById("uInput");
        const val = inp.value.trim();
        if (val) {
            chatRef.push({
                role: myRole,
                text: val,
                time: Date.now()
            });
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—É—à –¥—Ä—É–≥–æ–º—É —á–µ–ª–æ–≤–µ–∫—É
            sendPush(val);

            inp.value = "";
            if(navigator.vibrate) navigator.vibrate(15);
        }
    }

    chatRef.limitToLast(20).on("child_added", snap => {
        const m = snap.val();
        const box = document.getElementById("messages");
        const d = document.createElement("div");
        d.className = `msg ${m.role === myRole ? 'me' : 'her'}`;
        d.textContent = m.text;
        box.appendChild(d);
        box.scrollTop = box.scrollHeight;
    });

    function updateTimer() {
        const diff = Date.now() - new Date(START_DATE);
        document.getElementById("days").textContent = Math.floor(diff / 86400000);
        document.getElementById("hours").textContent = Math.floor(diff / 3600000) % 24;
        document.getElementById("mins").textContent = Math.floor(diff / 60000) % 60;
        document.getElementById("secs").textContent = Math.floor(diff / 1000) % 60;
    }
    setInterval(updateTimer, 1000);

    function createHeart() {
        if (document.hidden) return;
        const h = document.createElement("div");
        h.className = "heart-float";
        h.textContent = ["‚ù§Ô∏è", "üíñ", "üå∏", "üíï", "‚ú®"][Math.floor(Math.random()*5)];
        h.style.left = Math.random() * 100 + "vw";
        h.style.fontSize = Math.random() * 20 + 10 + "px";
        h.style.animationDuration = Math.random() * 4 + 3 + "s";
        document.body.appendChild(h);
        setTimeout(() => h.remove(), 7000);
    }
    setInterval(createHeart, 1000);

    document.getElementById("uInput").addEventListener("keypress", e => { if(e.key === "Enter") sendMsg(); });
</script>
</body>
</html>
